<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin User View</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f4f8fb; margin:0; padding:20px; }
        h2 { margin-bottom:10px; }
        .stats { display:flex; gap:20px; margin-bottom:20px; }
        .card { background:white; padding:20px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.1); flex:1; text-align:center; }
        .dropdown { margin-bottom:20px; }
        select { padding:8px 12px; border-radius:6px; border:1px solid #ccc; }

        /* Table styling with black borders */
        table {
            width:100%;
            border-collapse: collapse;
            background:white;
            border-radius:8px;
            overflow:hidden;
            border:1px solid black;
        }
        th, td {
            padding:12px 15px;
            border:1px solid black;
            text-align:left;
        }
        th {
            background:#3f51b5;
            color:white;
        }
        tr:hover { background:#f9f9f9; }

        table tr:last-child td {
            border-bottom:2px solid black;
        }

        .hidden { display:none; }

        /* Close button style */
        .close-btn {
            display:inline-block;
            background:#082848;
            color:white;
            padding:8px 14px;
            border-radius:6px;
            font-size:14px;
            font-weight:600;
            text-decoration:none;
            transition: background 0.3s ease;
            margin-bottom:15px;
        }
        .close-btn:hover { background:#3e6ea1; }

        /* Action dropdown style */
        .action-dropdown {
            padding:6px 10px;
            border-radius:6px;
            border:1px solid #333;
            background:#f9f9f9;
            font-size:14px;
        }

        /* Blocked user styling */
        .blocked {
            color:red;
            font-weight:bold;
        }
    </style>
</head>
<body>

    <!-- Close Button -->
    <a href="{{ url_for('admin_dashboard') }}" class="close-btn">‚úñ Close</a>

    <h2>üìä Admin User View</h2>

    <!-- Stats Section -->
    <div class="stats">
        <div class="card">
            <h3>{{ user_count }}</h3>
            <p>Total Users</p>
        </div>
        <div class="card">
            <h3>{{ feedback_count }}</h3>
            <p>Total Feedbacks</p>
        </div>
    </div>

    <!-- Dropdown to toggle tables -->
    <div class="dropdown">
        <label for="viewSelect">Select View:</label>
        <select id="viewSelect" onchange="toggleView()">
            <option value="users">Users</option>
            <option value="feedback">Feedback</option>
        </select>
    </div>

    <!-- Users Table -->
    <table id="userTable">
        <tr>
            <th>ID</th>
            <th>Full Name</th>
            <th>Username</th>
            <th>Email</th>
            <th>Actions</th>
        </tr>
        {% for user in users %}
        <tr class="{% if user['blocked'] == 1 %}blocked{% endif %}" {% if user['blocked'] == 1 %}style="font-weight:bold;"{% endif %}>
            <td>{{ user['id'] }}</td>
            <td>{{ user['fullname'] }}</td>
            <td>{{ user['username'] }}</td>
            <td>{{ user['email'] }}</td>
            <td>
                {% if user['blocked'] == 1 %}
                    <!-- Blocked user -->
                    <button style="background:black; color:red; font-weight:bold; cursor:default;">üö´ Blocked</button>
                    <a href="{{ url_for('block_user', user_id=user['id']) }}" onclick="return confirm('Do you want to unblock this user?');">
                        <button style="background:green; color:white;">üîì Unblock</button>
                    </a>
                {% else %}
                    <!-- Action dropdown for unblocked users -->
                    
                         <select class="action-dropdown" onchange="handleAction('{{ user.id }}', this.value)">

>

                        <option value="">---Select---</option>
                        <option value="edit">‚úèÔ∏è Edit</option>
                        <option value="block">üö´ Block</option>
                        <option value="delete">üóëÔ∏è Delete</option>
                    </select>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- Feedback Table -->
    <table id="feedbackTable" class="hidden">
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>College</th>
            <th>Feedback</th>
        </tr>
        {% for fb in feedbacks %}
        <tr>
            <td>{{ fb[0] }}</td>
            <td>{{ fb[1] }}</td>
            <td>{{ fb[2] }}</td>
            <td>{{ fb[3] }}</td>
        </tr>
        {% endfor %}
    </table>

<script>
    // Toggle between Users and Feedback tables
    function toggleView() {
        const selected = document.getElementById("viewSelect").value;
        document.getElementById("userTable").classList.add("hidden");
        document.getElementById("feedbackTable").classList.add("hidden");

        if (selected === "users") {
            document.getElementById("userTable").classList.remove("hidden");
        } else {
            document.getElementById("feedbackTable").classList.remove("hidden");
        }
    }

    // Handle actions for users
    function handleAction(userId, action) {
        if (!action) return;
        userId = encodeURIComponent(userId); // safe
        if (action === "edit") {
            window.location.href = "/edit_user/" + userId;
        } else if (action === "block") {
            if (confirm("Do you really want to block this user?")) {
                window.location.href = "/block_user/" + userId;
            }
        } else if (action === "delete") {
            if (confirm("Are you sure you want to delete user ID " + userId + "?")) {
                window.location.href = "/delete_user/" + userId;
            }
        }
    }
</script>
</body>
</html>
